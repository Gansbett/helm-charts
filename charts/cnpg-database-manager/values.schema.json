{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "CNPG Database Manager Helm Values",
  "type": "object",
  "properties": {
    "clusters": {
      "type": "object",
      "description": "PostgreSQL cluster configurations. Each key represents a cluster name.",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Enable or disable this cluster"
          },
          "instances": {
            "type": "integer",
            "minimum": 1,
            "description": "Number of PostgreSQL instances in the cluster"
          },
          "imageName": {
            "type": "string",
            "description": "PostgreSQL container image",
            "pattern": "^.+:.+$"
          },
          "storage": {
            "type": "object",
            "description": "Storage configuration",
            "properties": {
              "size": {
                "type": "string",
                "description": "Size of the persistent volume",
                "pattern": "^[0-9]+(Mi|Gi|Ti)$"
              },
              "storageClass": {
                "type": "string",
                "description": "Storage class name"
              }
            },
            "required": ["size"]
          },
          "resources": {
            "type": "object",
            "description": "Resource limits and requests",
            "properties": {
              "requests": {
                "type": "object",
                "properties": {
                  "memory": {
                    "type": "string"
                  },
                  "cpu": {
                    "type": "string"
                  }
                }
              },
              "limits": {
                "type": "object",
                "properties": {
                  "memory": {
                    "type": "string"
                  },
                  "cpu": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "maxConnections": {
            "type": "string",
            "description": "Maximum number of connections"
          },
          "sharedBuffers": {
            "type": "string",
            "description": "Shared memory buffers"
          },
          "effectiveCacheSize": {
            "type": "string",
            "description": "Effective cache size"
          },
          "maintenanceWorkMem": {
            "type": "string",
            "description": "Maintenance work memory"
          },
          "checkpointCompletionTarget": {
            "type": "string",
            "description": "Checkpoint completion target"
          },
          "walBuffers": {
            "type": "string",
            "description": "WAL buffers"
          },
          "defaultStatisticsTarget": {
            "type": "string",
            "description": "Default statistics target"
          },
          "randomPageCost": {
            "type": "string",
            "description": "Random page cost"
          },
          "effectiveIoConcurrency": {
            "type": "string",
            "description": "Effective I/O concurrency"
          },
          "workMem": {
            "type": "string",
            "description": "Work memory per operation"
          },
          "minWalSize": {
            "type": "string",
            "description": "Minimum WAL size"
          },
          "maxWalSize": {
            "type": "string",
            "description": "Maximum WAL size"
          },
          "parameters": {
            "type": "object",
            "description": "Additional custom PostgreSQL parameters",
            "additionalProperties": {
              "type": "string"
            }
          },
          "monitoring": {
            "type": "object",
            "description": "Monitoring configuration",
            "properties": {
              "enabled": {
                "type": "boolean",
                "description": "Enable Prometheus monitoring"
              },
              "podMonitor": {
                "type": "object",
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "description": "Enable PodMonitor resource"
                  }
                }
              }
            }
          },
          "backup": {
            "type": "object",
            "description": "Backup configuration",
            "properties": {
              "enabled": {
                "type": "boolean",
                "description": "Enable automated backups"
              },
              "schedule": {
                "type": "string",
                "description": "Backup schedule in cron format"
              },
              "retentionPolicy": {
                "type": "string",
                "description": "Backup retention policy"
              },
              "s3": {
                "type": "object",
                "description": "S3 configuration for backups",
                "properties": {
                  "bucket": {
                    "type": "string",
                    "description": "S3 bucket name"
                  },
                  "endpoint": {
                    "type": "string",
                    "description": "S3 endpoint URL"
                  },
                  "region": {
                    "type": "string",
                    "description": "S3 region"
                  },
                  "path": {
                    "type": "string",
                    "description": "Path prefix in bucket"
                  },
                  "accessKeyId": {
                    "type": "string",
                    "description": "S3 access key ID (required when S3 enabled)"
                  },
                  "secretAccessKey": {
                    "type": "string",
                    "description": "S3 secret access key (required when S3 enabled)"
                  },
                  "credentials": {
                    "type": "object",
                    "properties": {
                      "existingSecret": {
                        "type": "string",
                        "description": "Existing secret with S3 credentials"
                      }
                    }
                  }
                }
              }
            }
          },
          "initdb": {
            "type": "object",
            "description": "Custom initdb configuration",
            "properties": {
              "postInitSQL": {
                "type": "array",
                "description": "Custom SQL statements to run after initialization",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "databases": {
            "type": "array",
            "description": "Database and user definitions",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Database name",
                  "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
                },
                "owner": {
                  "type": "string",
                  "description": "Database owner/user name",
                  "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
                },
                "existingSecret": {
                  "type": "string",
                  "description": "Use existing secret for credentials"
                },
                "encoding": {
                  "type": "string",
                  "description": "Database encoding"
                },
                "locale": {
                  "type": "string",
                  "description": "Database locale"
                }
              },
              "required": ["name", "owner"]
            }
          }
        },
        "required": ["enabled", "instances", "imageName", "storage", "databases"]
      }
    }
  }
}